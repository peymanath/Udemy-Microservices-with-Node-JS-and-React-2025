WEBVTT

00:00.870 --> 00:04.590
توی ویدیوی قبلی سعی کردیم یک پست جدید ایجاد کنیم، ولی خیلی سریع به ارور CORS برخوردیم.

00:04.590 --> 00:05.010
همون خطای معروف CORS.

00:05.160 --> 00:08.910
یه یادآوری سریع: خطای CORS زمانی اتفاق می‌افته که...

00:08.910 --> 00:15.480
ما داریم از دامنه‌ای (یا پورت یا ساب‌دامین متفاوتی) به آدرسی درخواست می‌زنیم که با مبدأ فرق داره.

00:15.480 --> 00:19.350
یعنی دامنه یا پورت مقصد با اون چیزی که صفحه ازش لود شده، متفاوته.

00:19.530 --> 00:25.200
تو مثال ما، صفحه‌ی مرورگر روی `localhost:3000` باز شده ولی داریم درخواست POST می‌فرستیم به `localhost:4000`.

00:25.200 --> 00:27.300
چون این دو تا پورت فرق دارن، سیاست CORS فعال می‌شه.

00:27.360 --> 00:32.070
مرورگر به‌صورت خودکار هر درخواستی از `3000` به `4000` رو بلاک می‌کنه.

00:32.550 --> 00:37.470
یعنی اجازه نمی‌ده از `localhost:3000` به `localhost:4000` چیزی بفرستیم، مگر اینکه...

00:37.470 --> 00:39.330
مگر اینکه سرور روی `4000`

00:39.360 --> 00:40.170
یعنی همینجا

00:40.170 --> 00:41.220
بیاد و یه سری هدر مشخص برگردونه.

00:41.400 --> 00:44.880
هدرهایی که دقیقاً برای اجازه دادن به CORS هستن.

00:45.360 --> 00:49.670
برای رفع این ارور هیچ کاری توی مرورگر یا تنظیمات React نمی‌تونیم بکنیم.

00:49.680 --> 00:53.610
هیچ کانفیگی توی اپ فرانت‌اند نیست که این ارور رو حذف کنه.

00:53.610 --> 00:54.370
باید سمت سرور درستش کنیم.

00:54.390 --> 00:58.050
باید یه سری پیکربندی اضافه روی سرور انجام بدیم.

00:59.340 --> 01:00.480
بیا همین الان انجامش بدیم.

01:00.990 --> 01:03.240
اول از همه برمی‌گردم به ترمینال.

01:03.900 --> 01:09.240
قراره این کانفیگ رو هم روی سرویس posts و هم سرویس comments پیاده کنیم.

01:09.240 --> 01:11.880
تنها یه تکه تنظیم کوچیکه.

01:12.210 --> 01:15.690
ترمینالی که سرویس posts رو ران کرده بودم پیدا می‌کنم.

01:15.690 --> 01:19.530
سرور posts و همچنین سرور comments رو خاموش می‌کنم.

01:20.540 --> 01:22.310
بعد تو هر دو ترمینال...

01:22.310 --> 01:28.670
برای هر دو سرویس (posts و comments) دستور `npm install cors` رو اجرا می‌کنم.

01:29.510 --> 01:31.730
یکی اینجا، یکی اونجا. نصب انجام شد.

01:32.620 --> 01:33.600
پکیج خیلی کوچیکیه.

01:33.610 --> 01:38.050
فقط کمک می‌کنه با تنظیم یک سری هدر خاص، خطای CORS رو رفع کنیم.

01:38.500 --> 01:40.780
این هدرها روی پاسخ‌هایی که به مرورگر می‌رن ست می‌شن.

01:41.620 --> 01:47.320
بعد از نصب، دوباره سرویس posts و همچنین سرویس comments رو استارت می‌کنم.

01:47.350 --> 01:48.070
همه‌چی خوبه.

01:49.310 --> 01:53.270
حالا ادیتور رو برای هر دو پروژه باز می‌کنم تا از این پکیج CORS استفاده کنیم.

01:53.330 --> 01:54.800
ماژولی که نصب کردیم (cors) رو اضافه می‌کنیم.

01:56.430 --> 01:58.830
اول از سرویس پست‌ها شروع می‌کنیم.

02:01.540 --> 02:02.140
بریم سراغش.

02:02.500 --> 02:04.510
داخل فولدر posts هستم.

02:05.400 --> 02:07.590
فایل index.js رو باز می‌کنم.

02:08.680 --> 02:09.670
در ابتدای فایل،

02:09.670 --> 02:11.530
پکیج cors رو require می‌کنم.

02:14.480 --> 02:17.660
و بعد اون رو به عنوان middleware به اپلیکیشن Express اضافه می‌کنم.

02:17.660 --> 02:22.580
پس از `app.use(cors())` استفاده می‌کنم. حواست باشه باید به صورت تابعی صداش بزنی.

02:24.310 --> 02:25.150
این فایل رو ذخیره می‌کنم.

02:26.680 --> 02:30.370
حالا دقیقاً همین کار رو برای پروژه comments هم انجام می‌دم.

02:30.730 --> 02:32.830
برمی‌گردم به پروژه کامنت‌ها.

02:33.160 --> 02:36.160
وارد پروژه comments می‌شم.

02:38.580 --> 02:39.270
در ابتدای فایل،

02:39.270 --> 02:41.430
دوباره پکیج cors رو require می‌کنم.

02:45.190 --> 02:47.980
و اون رو مثل قبل به عنوان middleware به express اضافه می‌کنم.

02:48.430 --> 02:52.420
و باز هم توجه کن که باید `cors()` به صورت تابعی صدا زده بشه.

02:53.970 --> 02:56.520
ذخیره می‌کنم، همه‌چیز آماده‌ست.

02:57.270 --> 03:01.500
حالا بریم مرورگر و دوباره تلاش کنیم یک پست جدید بسازیم.

03:02.430 --> 03:05.430
صفحه رو رفرش می‌کنم تا ارورهای قبلی پاک بشن.

03:06.440 --> 03:07.970
یه عنوان وارد می‌کنم.

03:07.970 --> 03:12.530
می‌نویسم «اولین پست»، دکمه ارسال رو می‌زنم... و عالیه!

03:12.530 --> 03:14.150
درخواست با موفقیت ارسال شد.

03:14.600 --> 03:18.830
کد پاسخ ۲۰۱ دریافت کردیم یعنی پست ساخته شده.

03:19.950 --> 03:21.570
تا اینجا پیشرفت خیلی خوبی داشتیم.

03:21.570 --> 03:23.430
و ارور CORS هم دیگه وجود نداره.

03:24.930 --> 03:28.440
از این به بعد هر سرویسی که به پروژه اضافه می‌کنیم، از اول پکیج cors رو نصب و فعال می‌کنیم.

03:28.440 --> 03:32.760
تا توی مراحل بعدی پروژه بزرگ‌تری که قراره توی این دوره انجام بدیم، به این ارور نخوریم.

03:32.760 --> 03:36.240
در اون پروژه بزرگ، یه سری تغییر معماری انجام می‌دیم

03:36.240 --> 03:40.590
که باعث می‌شه درخواست‌هامون از یه دامنه به دامنه دیگه ارسال نشن.

03:40.590 --> 03:45.750
بلکه همه درخواست‌ها و APIها در کنار هم قرار بگیرن (co-located).

03:45.750 --> 03:49.020
و این مشکل CORS دیگه اصلاً اتفاق نیفته.

03:49.020 --> 03:53.130
با این ساختار جدید دیگه از مرورگر به چند URL مختلف درخواست نمی‌فرستیم.

03:54.400 --> 03:54.700
خب،

03:54.700 --> 03:55.780
اینجا یه توقف کوتاه می‌کنیم.

03:55.870 --> 03:59.890
توی ویدیوی بعدی که ساخت پست‌مون کامل شده، ادامه می‌دیم.

04:00.400 --> 04:03.820
قراره بریم سراغ ساخت کامپوننت PostList و بعدش هم قابلیت نمایش کامنت‌ها

04:03.820 --> 04:06.970
و امکان اضافه کردن کامنت رو پیاده‌سازی می‌کنیم.

04:07.000 --> 04:08.440
پس خیلی زود می‌بینمت.