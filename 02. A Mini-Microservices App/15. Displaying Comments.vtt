WEBVTT

00:00.880 --> 00:01.330
خب بریم سراغ آخرین کامپوننت.

00:01.330 --> 00:02.470
این دیگه آخریشه.

00:02.470 --> 00:05.770
همین که اینو تموم کنیم، همون‌طور که قبلاً چند بار گفتم، تازه مشکلات شروع می‌شن.

00:05.770 --> 00:08.170
و دقیقاً از اینجا دوباره وارد دنیای میکروسرویس‌ها می‌شیم.

00:08.170 --> 00:11.080
فقط یه مقدار دیگه مونده از این بخش ری‌اکتی.

00:11.200 --> 00:13.030
بزن بریم اینم تموم کنیم.

00:13.060 --> 00:14.320
می‌ریم توی ادیتور.

00:14.470 --> 00:15.820
و کامپوننت comment list رو می‌سازیم.

00:15.820 --> 00:18.220
یعنی لیست کامنت‌های هر پست.

00:18.820 --> 00:24.910
توی پروژه React، داخل فولدر src، یه فایل جدید می‌سازم به اسم CommentList.js

00:30.250 --> 00:36.280
بالای فایل، React و useState رو ایمپورت می‌کنیم.

00:37.340 --> 00:39.260
axios رو هم از پکیج axios میاریم.

00:39.290 --> 00:43.120
و دوباره یادمون نره useEffect رو هم لازم داریم.

00:43.130 --> 00:44.900
پس اونم از React ایمپورت می‌کنیم.

00:46.660 --> 00:48.910
بعد یه export default تعریف می‌کنیم.

00:51.050 --> 00:54.350
فعلاً یه div خالی برمی‌گردونیم تا ساختارمون کامل باشه.

00:55.290 --> 00:57.270
خب قراره توی این کامپوننت چی کار کنیم؟

00:57.300 --> 00:59.670
تقریباً همون کاری که توی comment create انجام دادیم.

00:59.670 --> 01:05.120
این کامپوننت قراره داده‌های مربوط به خودش رو مدیریت کنه.

01:05.130 --> 01:10.530
یعنی باید خودش بتونه به سرویس کامنت وصل بشه و کامنت‌های مربوط به یه پست خاص رو بگیره.

01:10.530 --> 01:12.720
اون پست خاص رو باید بدونیم چیه.

01:13.290 --> 01:17.310
اگه دوباره یه نگاهی به طراحی API سرویس کامنت بندازیم، اینجاست:

01:17.790 --> 01:23.670
ما گفتیم که میشه یه درخواست GET بفرستیم به: /posts/:postId/comments

01:24.150 --> 01:29.550
پس دقیقاً مثل کاری که توی post create کردیم، اینجا هم باید شناسه پست رو داشته باشیم.

01:29.550 --> 01:31.410
یعنی ID اون پستی که می‌خوایم کامنت‌هاشو نشون بدیم.

01:32.120 --> 01:37.220
پس باید از post list، شناسه پست رو به comment list پاس بدیم.

01:37.220 --> 01:38.540
به صورت prop.

01:40.810 --> 01:45.910
بنابراین، داخل کامپوننت comment list فرض می‌کنیم که prop مربوط به postId دریافت میشه.

01:45.910 --> 01:48.130
و می‌تونیم با استفاده از اون دیتا بگیریم.

01:50.060 --> 01:55.550
بعد می‌نویسیم که چطور دیتا رو fetch کنیم، بریزیم توی state، روی state map بزنیم و لیست کامنت‌ها رو نشون بدیم.

01:55.550 --> 01:59.120
در عمل، ساختار این کامپوننت خیلی شبیه بقیه کامپوننت‌هایی میشه که قبلاً نوشتیم.

02:04.040 --> 02:06.470
دقیقاً شبیه کاری که لحظاتی پیش توی post list انجام دادیم.

02:06.740 --> 02:08.150
قراره یه state داشته باشیم،

02:08.150 --> 02:09.850
یه تابع برای گرفتن دیتا تعریف کنیم،

02:09.860 --> 02:14.000
اون تابع رو از داخل useEffect صدا بزنیم و در نهایت روی دیتا map بزنیم.

02:14.150 --> 02:16.850
حالا که می‌دونیم دقیقاً چی می‌خوایم، بریم سراغ کدنویسی.

02:17.710 --> 02:23.140
اول از همه، useState رو برای تعریف state به اسم comments و تابع setComments استفاده می‌کنیم.

02:25.570 --> 02:28.630
مقدار اولیه‌ش رو یه آرایه خالی قرار می‌دیم.

02:28.900 --> 02:33.130
یادت باشه توی post list مقدار اولیه یه آبجکت بود.

02:33.340 --> 02:37.510
ولی اینجا چون از API قراره آرایه کامنت‌ها رو بگیریم، نوعش آرایه‌ست.

02:37.540 --> 02:42.790
API ما لیستی از کامنت‌های مرتبط با اون پست رو برمی‌گردونه، نه یه آبجکت.

02:42.790 --> 02:45.490
پس می‌دونیم با آرایه سروکار داریم.

02:46.640 --> 02:48.740
بعد یه تابع تعریف می‌کنیم به اسم fetchData

02:49.160 --> 02:50.750
تابعی async هست.

02:52.580 --> 02:53.420
داخلش

02:53.420 --> 02:57.890
با استفاده از await axios یه درخواست می‌فرستیم و response رو می‌گیریم.

02:58.490 --> 03:00.620
از template string برای URL استفاده می‌کنیم.

03:01.790 --> 03:05.840
آدرس میشه: http://localhost

03:05.840 --> 03:11.150
و چون سرویس کامنت‌ها روی پورت 4001 ران شده، اون پورت رو استفاده می‌کنیم.

03:14.000 --> 03:20.330
و مسیرش میشه: /posts/${postId}/comments

03:23.940 --> 03:28.710
بعد از گرفتن response، دیتا رو ازش استخراج می‌کنیم و با setComments می‌ریزیم توی state.

03:28.710 --> 03:29.550
یعنی:

03:29.550 --> 03:32.070
setComments(res.data)

03:32.070 --> 03:33.600
همین سادگی.

03:35.420 --> 03:39.560
بعدش باید مطمئن شیم که این تابع فقط یک بار اجرا بشه، وقتی کامپوننت لود شد.

03:39.560 --> 03:40.640
برای همین از useEffect استفاده می‌کنیم.

03:40.670 --> 03:43.250
useEffect رو صدا می‌زنیم.

03:43.960 --> 03:46.840
می‌خوایم فقط یه بار اجرا بشه، پس آرگومان دومش یه آرایه خالیه.

03:48.980 --> 03:52.250
داخل تابع useEffect فقط fetchData رو صدا می‌زنیم.

03:52.250 --> 03:54.770
همین و بس.

03:56.640 --> 03:57.900
و کار تمومه.

03:59.270 --> 04:00.890
حالا مرحله آخر اینه که روی آرایه کامنت‌ها map بزنیم

04:02.680 --> 04:03.760
و یه خروجی JSX بسازیم.

04:05.310 --> 04:10.680
یعنی از هر آیتم کامنت، یه تگ یا المنت متنی بسازیم و نشونش بدیم.

04:10.680 --> 04:11.250
بریم سراغ ساختن این بخش.

04:15.920 --> 04:19.370
توی طراحی اولیه‌مون، لیست کامنت‌ها رو به صورت unordered list نشون دادیم.

04:19.370 --> 04:21.110
یعنی یک UL با liهای متعدد.

04:21.110 --> 04:24.830
پس بیایم روی آرایه‌ی کامنت‌ها map بزنیم.

04:24.950 --> 04:29.210
یه متغیر به اسم renderedComments تعریف می‌کنیم که از comments.map به دست میاد.

04:30.130 --> 04:32.110
و برای هر comment داخل اون لیست...

04:32.900 --> 04:34.670
یه li برمی‌گردونیم.

04:36.490 --> 04:40.960
داخل li، محتوای comment رو نمایش می‌دیم. چون هر کامنت یه فیلد content داره.

04:40.960 --> 04:42.520
پس می‌نویسیم comment.content

04:42.610 --> 04:46.810
چون داریم لیست تولید می‌کنیم، ری‌اکت انتظار داره که هر li یه key داشته باشه.

04:46.810 --> 04:50.530
برای key از comment.id استفاده می‌کنیم.

04:51.360 --> 04:55.770
در نهایت، خروجی کامپوننت یه تگ UL خواهد بود

05:03.530 --> 05:06.590
و داخلش renderedComments رو قرار می‌دیم.

05:08.140 --> 05:08.860
و همین کافیه.

05:09.890 --> 05:11.030
کارمون تمومه.

05:11.600 --> 05:13.280
حالا فایل رو ذخیره می‌کنیم.

05:14.920 --> 05:17.530
برمی‌گردیم به فایل post list

05:17.530 --> 05:19.480
چون قراره اونجا این کامپوننت رو نشون بدیم.

05:19.750 --> 05:23.260
یعنی توی post list باید برای هر پست، یه نسخه از comment list رو نمایش بدیم.

05:24.950 --> 05:26.660
می‌ریم داخل post list component

05:27.480 --> 05:28.110
بالای فایل

05:28.110 --> 05:31.230
commentList رو ایمپورت می‌کنیم.

05:32.210 --> 05:33.740
از مسیر comment-list

05:37.080 --> 05:39.960
حالا می‌ریم پایین، به map مربوط به renderedPosts

05:39.960 --> 05:41.970
یعنی جایی که روی پست‌ها پیمایش کردیم.

05:42.710 --> 05:46.370
و بعد از نمایش هر پست، می‌خوایم لیست کامنت‌هاش رو هم نشون بدیم.

05:47.400 --> 05:48.960
ولی نه بعد از فرم ارسال کامنت.

05:48.960 --> 05:52.440
قبل از اون، چون اول باید کامنت‌های فعلی رو ببینه، بعد بتونه کامنت جدید بزنه.

05:52.440 --> 05:53.310
پس اینجا...

05:53.400 --> 05:59.760
کامپوننت commentList رو قرار می‌دیم. ولی باید postId مربوطه رو بهش بدیم.

05:59.760 --> 06:03.220
چون commentList باید بدونه که برای کدوم پست باید کامنت‌ها رو لود کنه.

06:03.240 --> 06:03.840
پس

06:03.870 --> 06:05.790
دقیقاً مثل commentCreate، به commentList هم prop مربوط به postId رو پاس می‌دیم.

06:09.570 --> 06:12.360
پس می‌نویسیم: postId برابر با post.id

06:14.010 --> 06:14.330
خب

06:14.340 --> 06:16.440
فایل رو ذخیره می‌کنیم و یه تست می‌گیریم.

06:18.120 --> 06:19.370
آره، مشخصه.

06:19.380 --> 06:21.000
کامنتی که همین چند لحظه پیش ساختم نشون داده میشه.

06:21.000 --> 06:21.270
اون بالا

06:21.270 --> 06:21.870
دقیقاً همینه.

06:22.350 --> 06:24.150
حالا باید بتونم یه کامنت دیگه بسازم.

06:24.150 --> 06:25.980
می‌نویسم: کامنت دوم

06:26.550 --> 06:27.420
ارسالش می‌کنم.

06:28.430 --> 06:32.930
صفحه رو رفرش می‌کنم چون هنوز هیچ منطقی برای بروزرسانی لحظه‌ای ننوشتیم.

06:32.930 --> 06:33.590
فعلاً باید دستی رفرش کنیم.

06:33.800 --> 06:37.820
بعد از رفرش، کامنت دوم هم نشون داده میشه. حالا می‌تونم برای بقیه پست‌ها هم کامنت بذارم.

06:37.820 --> 06:38.780
مثلاً می‌نویسم: پست جالبی بود

06:38.990 --> 06:42.080
و برای سومی یه چیزی مثل: این پست فوق‌العاده‌ست

06:43.420 --> 06:47.680
بعدش صفحه رو رفرش می‌کنم و کامنت‌ها رو می‌بینم.

06:48.800 --> 06:51.320
خب، پس فعلاً همه‌چی درست کار می‌کنه.

06:52.150 --> 06:53.530
ولی همون‌طور که قبلاً گفتم، یه اشکال مهم اینجا وجود داره.

06:53.530 --> 06:57.250
بذار دقیق‌تر نشونت بدم.

06:57.670 --> 07:03.160
اگه یه نگاه به تب Network بندازیم، فیلتر رو گذاشتم روی XHR

07:03.160 --> 07:08.260
حالا وقتی صفحه رو رفرش می‌کنم، می‌خوام یه نکته خیلی ساده رو نشونت بدم. شاید اولش بی‌اهمیت به نظر برسه.

07:08.270 --> 07:08.800
ولی نیست.

07:09.100 --> 07:14.770
برای هر پستی که گرفتیم، یه درخواست جداگونه برای کامنت‌ها فرستاده میشه. و این همون مشکل اصلیه که الان داریم.

07:14.770 --> 07:15.700
ممکنه الآن مهم به نظر نرسه...

07:16.180 --> 07:18.640
ولی یه وقفه بگیریم، ویدیو بعدی دلیلش رو کامل توضیح می‌دم.

07:18.670 --> 07:19.540
که چرا این موضوع انقدر مهمه.

07:19.540 --> 07:22.450
پس تا چند لحظه دیگه می‌بینمت.
