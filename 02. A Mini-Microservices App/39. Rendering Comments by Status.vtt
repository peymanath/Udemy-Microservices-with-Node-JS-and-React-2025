WEBVTT

00:00.870 --> 00:05.280
بیایم اپلیکیشن React خودمون رو باز کنیم و یه تغییر کوچیک توی لیست کامنت‌ها بدیم.

00:05.850 --> 00:11.490
می‌رم توی ادیتور، داخل فولدر client، بعدش src، و همون‌طور که می‌دونی همه‌ی کامنت‌ها داخل کامپوننت CommentList رندر می‌شن.

00:11.490 --> 00:13.920
اینجاست، کامپوننت CommentList.

00:14.180 --> 00:15.270
توی این کامپوننت،

00:15.750 --> 00:16.680
روی تمام کامنت‌ها loop می‌زنیم و برای هرکدوم یک li تولید می‌کنیم.

00:16.680 --> 00:20.040
حالا باید وضعیت هر کامنت رو بررسی کنیم، و اگر status برابر با "rejected" یا "pending" بود،

00:20.610 --> 00:26.670
نمی‌خوایم متن کامنت رو همون‌طور نشون بدیم. شاید بخوایم چیز دیگه‌ای نمایش بدیم یا لااقل محتوای داخلش رو عوض کنیم.

00:26.670 --> 00:28.640
بیایم یک سری if ساده بنویسیم.

00:28.650 --> 00:32.070
یه متغیر جدید به اسم content تعریف می‌کنم.

00:32.880 --> 00:36.540
بعد می‌گم اگر status برابر بود با "approved"...

00:37.050 --> 00:39.540
مقدار content همون متن کامنت باشه.

00:40.050 --> 00:41.550
اگر status برابر با "pending" بود،

00:42.990 --> 00:45.870
content بشه: این کامنت در انتظار بررسی است.

00:47.030 --> 00:50.540
و اگر status برابر با "rejected" بود،

00:53.570 --> 00:57.200
content بشه: این کامنت رد شده است.

00:58.480 --> 00:59.170
می‌تونی این ifها رو هم با switch بازنویسی کنی، اگه خواستی.

01:00.560 --> 01:01.960
من دیگه به انتخاب خودت می‌ذارم.

01:01.970 --> 01:05.480
در نهایت، به‌جای اینکه comment.content رو مستقیماً نشون بدیم، مقدار متغیر content رو نمایش می‌دیم.

01:07.020 --> 01:10.890
یه مقدار content توی JSX قرار می‌دم.

01:12.310 --> 01:13.780
خب، سیو می‌کنم.

01:14.600 --> 01:17.540
برمی‌گردم به مرورگر.

01:18.920 --> 01:22.880
حالا می‌بینی که کامنتی که کلمه "orange" توش بود، با جمله «این کامنت رد شده است» جایگزین شده.

01:22.880 --> 01:23.330
عالیه.

01:23.360 --> 01:24.440
خیلی خوب.

01:25.410 --> 01:30.420
حالا می‌خوام حالت دیگه‌ای رو هم تست کنم که توی اون کامنت بلافاصله بررسی نشه.

01:30.420 --> 01:33.150
یعنی سناریویی که نیاز به بررسی دستی توسط انسان داره.

01:53.860 --> 01:58.900
فرض کن بررسی یک کامنت ۵، ۱۰ یا حتی ۲۰ دقیقه طول بکشه تا یه نفر بیاد و بررسی‌ش کنه.

01:59.050 --> 02:05.050
پس اگه وضعیت کامنت از "pending" به "rejected" یا "approved" تغییر نکنه، باید پیام "این کامنت در انتظار بررسی است" رو ببینیم.

02:05.080 --> 02:08.320
برای شبیه‌سازی این حالت، می‌تونیم سرویس moderation رو کامل خاموش کنیم.

02:08.650 --> 02:13.390
می‌ریم داخل ترمینال و سرویس moderation رو متوقف می‌کنیم.

02:13.390 --> 02:14.140
برمی‌گردم به ترمینال.

02:14.850 --> 02:16.110
اون پنجره‌ای که moderation توش فعاله رو پیدا می‌کنم.

02:16.140 --> 02:19.380
و عملیاتش رو متوقف می‌کنم.

02:19.680 --> 02:21.690
حالا می‌رم یه کامنت جدید می‌سازم.

02:22.650 --> 02:24.480
کامنت رو ارسال می‌کنم.

02:28.530 --> 02:29.430
حالا اون کامنت می‌مونه توی وضعیت "pending".

02:29.940 --> 02:32.460
چون هیچ سرویسی وجود نداره که بخواد تأییدش کنه یا ردش کنه.

02:32.460 --> 02:35.400
حالا صفحه رو رفرش می‌کنیم و می‌بینیم که پیام "این کامنت در انتظار بررسی است" نمایش داده میشه.

02:35.670 --> 02:39.270
عالیه.

02:39.570 --> 02:40.170
خب.

02:41.250 --> 02:41.520
تا اینجا همه‌چیز خوبه.

02:41.520 --> 02:42.690
اما می‌خوام یه نکته‌ی مهم رو بگم.

02:42.690 --> 02:46.410
الان ما سرویس moderation رو خاموش کردیم.

02:46.770 --> 02:49.080
حالا اگه دوباره روشنش کنیم چی میشه؟

02:49.320 --> 02:51.690
می‌رم توی ترمینال و دوباره اجراش می‌کنم.

02:51.690 --> 02:54.000
سرویس moderation دوباره اجرا میشه.

02:54.390 --> 03:00.210
ولی مسئله اینه که event bus یا همون broker ما زمانی که moderation خاموش بود، سعی کرده یه event براش بفرسته.

03:00.210 --> 03:02.670
و اون event گم شده.

03:02.820 --> 03:07.890
پس الان با یه سناریویی طرفیم که سرویس moderation موقتاً قطع بوده و در اون بازه رویدادهایی از دست رفته.

03:07.890 --> 03:09.480
و الان کل سیستم ما از هم هماهنگ نیست.

03:09.480 --> 03:12.840
راهی هم نداریم که این رویدادهای از دست‌رفته رو بازیابی کنیم و دوباره به moderation برسونیم.

03:12.840 --> 03:17.670
شاید بد نباشه به این مشکل فکر کنیم و دنبال راه‌حلی براش باشیم.

03:17.670 --> 03:18.330
یه توقف کوتاه می‌کنیم.

03:18.750 --> 03:22.110
ببینیم چطور می‌تونیم با این مشکل کنار بیایم یا حلش کنیم.

03:22.440 --> 03:25.530
یه مکث می‌کنیم و توی لحظات بعد راهکاری برای این وضعیت بررسی می‌کنیم.
