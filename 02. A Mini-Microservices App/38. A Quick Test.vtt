WEBVTT

00:00.890 --> 00:02.240
فقط یک قدم بزرگ دیگه مونده.

00:02.240 --> 00:06.350
باید مطمئن بشیم که سرویس کوئری ما بازه و رویداد "comment updated" رو گوش می‌ده.

00:06.350 --> 00:10.220
هر وقت این رویداد رو دریافت کردیم، باید کامنت مورد نظر رو از حافظه پیدا کنیم و

00:10.220 --> 00:13.730
وضعیتش رو با وضعیتی که توی رویداد اومده، به‌روزرسانی کنیم.

00:13.880 --> 00:14.720
پس بریم سراغش.

00:14.720 --> 00:16.340
بریم سرویس کوئری رو باز کنیم.

00:17.420 --> 00:18.620
برمی‌گردیم به ادیتورمون.

00:19.930 --> 00:22.570
سرویس کوئری‌م رو پیدا می‌کنم.

00:22.600 --> 00:24.850
فایل index مربوط به اون رو باز می‌کنم.

00:25.780 --> 00:28.900
و می‌گردم دنبال جایی که همه رویدادهای ورودی رو پردازش می‌کنیم.

00:30.480 --> 00:34.950
یه شرط if جدید اضافه می‌کنم که رویداد از نوع "comment updated" باشه.

00:36.400 --> 00:37.750
Comment updated.

00:39.800 --> 00:45.260
بعدش فیلدهای id، content، postId و status رو از data استخراج می‌کنیم.

00:46.300 --> 00:47.110
از داده‌ها.

00:48.540 --> 00:51.720
و دوباره سعی می‌کنیم کامنت مورد نظر رو پیدا کنیم.

00:52.110 --> 00:55.920
یادآوری سریع: همه پست‌هامون رو داخل یه آبجکت ذخیره کردیم.

00:55.920 --> 00:57.200
پس باید توی همون آبجکت بگردیم.

00:57.210 --> 01:00.420
کامنت‌های مربوط به پست مورد نظر رو پیدا می‌کنیم.

01:00.420 --> 01:04.650
و دقیقاً مثل قبل، باید داخل اون آرایه از کامنت‌ها بگردیم تا کامنتی که باید به‌روزرسانی بشه رو پیدا کنیم.

01:04.650 --> 01:05.550
خیلی شبیه به کاریه که لحظاتی قبل توی سرویس کامنت کردیم.

01:05.550 --> 01:10.710
یعنی دقیقا مشابه کدی که توی ویدیو قبلی نوشتیم.

01:11.370 --> 01:13.710
می‌نویسیم: post مساوی با

01:15.230 --> 01:17.120
posts با کلید postId.

01:21.400 --> 01:23.860
بعد کامنت مناسب رو پیدا می‌کنیم.

01:25.110 --> 01:30.480
یعنی post.comments.find و روی همه کامنت‌ها پیمایش می‌کنیم.

01:31.380 --> 01:37.620
و کامنتی رو برمی‌گردونیم که id اون با id کامنتی که قراره آپدیت بشه برابر باشه.

01:41.770 --> 01:43.240
بعد اون کامنت رو آپدیت می‌کنیم.

01:44.220 --> 01:47.880
یعنی statusش رو می‌ذاریم برابر با status جدید.

01:48.060 --> 01:52.770
ولی یادت باشه، رویداد "comment updated" اینجا یه به‌روزرسانی کلیه، یعنی می‌گه این کامنت یک سری ویژگی جدید داره.

01:52.770 --> 01:54.900
پس احتمال زیاد فقط status آپدیت نشده، شاید متن کامنت هم تغییر کرده باشه.

01:55.080 --> 02:00.210
پس بهتره اون ویژگی content هم که توی event اومده رو هم استفاده کنیم و محتوای کامنت رو هم به‌روزرسانی کنیم.

02:00.210 --> 02:01.610
چون دقیق نمی‌دونیم چی تغییر کرده.

02:01.620 --> 02:06.000
پس منطقیه که تمام خصوصیات ارسالی از سمت event رو اعمال کنیم.

02:07.470 --> 02:10.020
ممکنه چیزی که تغییر کرده فقط وضعیت باشه یا محتوا، واقعاً معلوم نیست.

02:10.020 --> 02:13.470
ما فقط همه ویژگی‌های آپدیت‌شده رو می‌گیریم و به این کامنت نسبت می‌دیم.

02:14.070 --> 02:15.240
پس می‌نویسیم:

02:15.240 --> 02:17.520
comment.content برابر با content جدید.

02:20.530 --> 02:21.970
و در واقع همین بود، تموم شد.

02:22.000 --> 02:26.290
لازم نیست این شیء رو دوباره توی آرایه‌ی کامنت‌ها ذخیره کنیم یا جایگزینش کنیم، چون داریم مستقیماً همون شیء داخل حافظه رو آپدیت می‌کنیم.

02:30.530 --> 02:31.100
خب

02:31.100 --> 02:33.830
تا الان کلی تغییر ایجاد کردیم.

02:33.830 --> 02:39.710
و می‌خوام بگم احتمالاً یه جایی وسط این فرایند با خودت گفتی: وای، این خیلی عجیب و پیچیده‌ست!

02:39.710 --> 02:41.750
یا مثلاً گفتی: از کجا بدونم چی داره تغییر می‌کنه؟

02:41.750 --> 02:44.330
این سوال‌ها خیلی خوبن و طبیعین.

02:44.630 --> 02:46.340
واقعاً هم همینطوره.

02:46.340 --> 02:50.900
اگه وسط این فرایند آپدیت سرویس‌ها گیج نشده باشی، واقعاً برام عجیبه!

02:50.900 --> 02:52.220
چون این کارا واقعاً سخت بودن.

02:52.370 --> 02:57.890
و اگه تونسته باشی همه این تغییرات رو بدون حتی یه اشتباه تایپی انجام بدی، واقعاً کار بزرگیه.

03:00.230 --> 03:04.610
فقط اینو تو ذهنت داشته باش، چون این رفت و برگشت بین سرویس‌ها، اضافه کردن رویداد جدید، تغییر در رویدادها، همه‌ش خیلی دردسر داره.

03:04.610 --> 03:09.620
و بدون شک اگه بخوایم وارد ساخت یه اپلیکیشن بزرگتر بشیم، نیاز به ابزارهای بهتر

03:09.620 --> 03:13.700
یا متدولوژی دقیق‌تری برای مدیریت تعریف این همه رویداد بین سرویس‌ها داریم.

03:13.700 --> 03:19.700
بدون هیچ شکی باید به راه‌حل بهتری فکر کنیم.

03:19.700 --> 03:20.810
شکی درش نیست.

03:20.810 --> 03:26.450
ما باید راه بهتری برای مدیریت این چیزها داشته باشیم، چون سه ویدیوی آخر واقعاً خسته‌کننده و سخت بودن.

03:27.830 --> 03:31.610
با این حال، وقتشه که بالاخره یه تست از برنامه بگیریم ببینیم این ماژول مدیریت کامنت واقعاً کار می‌کنه یا نه.

03:31.610 --> 03:32.930
بیایم امتحان کنیم.

03:32.960 --> 03:37.730
یادت باشه که هنوز توی بخش React این اپلیکیشن چیزی نداریم که نشون بده آیا کامنت تأیید شده یا رد شده یا نه.

03:37.730 --> 03:42.230
پس فعلاً باید بریم لاگ درخواست‌های شبکه توی Chrome رو نگاه کنیم و مطمئن بشیم که وضعیت کامنت‌ها درست ثبت شده.

03:42.260 --> 03:46.160
الان قبل از اینکه تست رو شروع کنیم، یه نگاهی به ترمینال می‌ندازم ببینم تو هیچ‌کدوم از پنجره‌ها خطا نیست.

03:46.160 --> 03:49.850
اگه خطایی ببینی یعنی احتمالاً یه جایی توی کدت اشتباه تایپی داشتی.

03:50.690 --> 03:54.230
قبل از شروع تست فقط یه نکته سریع بگم:

03:54.230 --> 03:57.800
اگه تست رو انجام دادی و هیچ خطایی نداشتی، من واقعاً تعجب می‌کنم!

03:57.890 --> 04:01.280
چون کلی تغییر انجام دادیم و کلی جا هست که خیلی راحت می‌شه اشتباه کرد.

04:01.700 --> 04:04.070
خب، بریم توی مرورگر و تست رو شروع کنیم.

04:04.070 --> 04:09.470
صفحه رو رفرش می‌کنم، یه پست جدید می‌سازم، یه کامنت اضافه می‌کنم و بعدش برمی‌گردم به ترمینال ببینم چی شده.

04:09.470 --> 04:15.710
اگه برگردم به ترمینال و هیچ خطایی نبینم یعنی فعلاً اوضاع خوبه.

04:15.710 --> 04:18.200
باز هم می‌گم، خیلی محتمله که یه جایی توی کدت ارور داشته باشی.

04:19.390 --> 04:22.240
اگه خطا دیدی، می‌تونی خودت سعی کنی رفعش کنی یا از کد نهایی آماده استفاده کنی که همراه دوره گذاشتم.

04:22.480 --> 04:23.830
خب، بریم صفحه رو رفرش کنیم.

04:24.190 --> 04:26.080
یه پست جدید ایجاد می‌کنم.

04:26.080 --> 04:27.910
می‌نویسم مثلاً "new post".

04:29.580 --> 04:35.820
دوباره صفحه رو رفرش می‌کنم، یه کامنت اضافه می‌کنم و ارسال می‌زنم و برمی‌گردم به ترمینال.

04:35.820 --> 04:36.660
ببینم چی داریم.

04:37.140 --> 04:39.670
وقتی برمی‌گردم می‌بینم هیچ اروری نیست.

04:39.690 --> 04:43.920
باز هم می‌گم، خیلی محتمله که شما یه ارور ببینید، چون جاهای زیادی برای اشتباه وجود داره.

04:43.950 --> 04:48.840
اگه ارور دیدی، یا خودت دنبالش بگرد و حلش کن یا سورس کد کامل رو دانلود کن و با اون اجرا کن.

04:53.460 --> 04:54.630
الان دوباره برمی‌گردم.

04:54.660 --> 04:55.880
صفحه رو رفرش می‌کنم.

04:55.890 --> 04:57.420
کامنت رو همونجا می‌بینم.

04:58.020 --> 05:03.120
اگه توی تب Network برید، لیست پست‌هامون رو ببینید و پست رو باز کنید، می‌بینید که کامنت "approved" شده.

05:09.980 --> 05:10.100
خب

05:10.250 --> 05:11.090
عالیه

05:11.120 --> 05:13.850
الان بیایم یه کامنتی بذاریم که باید رد بشه.

05:14.000 --> 05:16.070
یه کامنت می‌نویسم

05:17.090 --> 05:18.200
"orange"

05:18.410 --> 05:19.490
ارسالش می‌کنم

05:20.200 --> 05:21.340
صفحه رو رفرش می‌کنم

05:22.420 --> 05:25.450
دوباره روی درخواست پست کلیک می‌کنم

05:26.030 --> 05:28.130
باید کامنت دوم رو اینجا ببینم

05:28.130 --> 05:32.750
و این بار وضعیتش باید "rejected" باشه چون شرط رد کردن کامنت شامل کلمه "orange" بود

05:33.110 --> 05:34.640
یعنی مکانیزم داره درست کار می‌کنه

05:35.120 --> 05:37.910
تا اینجای کار خیلی خوب پیش رفته

05:39.460 --> 05:42.340
تنها کاری که مونده اینه که React اپلیکیشن رو آپدیت کنیم

05:42.340 --> 05:45.930
باید توی React نشون بدیم که این کامنت رد شده

05:45.940 --> 05:50.590
یا اینکه بگیم کامنت هنوز توی وضعیت بررسیه، اگه status اون "pending" باشه

05:50.590 --> 05:52.870
پس بریم سراغ اپلیکیشن React و اونجا درستش کنیم